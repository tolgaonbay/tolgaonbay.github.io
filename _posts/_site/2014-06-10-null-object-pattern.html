<p>A couple of months ago I needed to write a logging mechanism where logs weren’t always necessary to be persisted and log objects had to be transferred between methods, so each method assigns some specific attributes of the log object before being persisted. I know the latter seems like a terrible design, but not everybody can work on a state-of-the-art system like some lucky guys do!</p>

<p>You can get a feeling of the log class below:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AuditLog</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">...</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="o">...</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{</span>
		<span class="c1">//Persist to database</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>Standard procedure is of course passing null reference to the methods when there is no need to log and afterwards checking if the object is not null, so you can invoke its methods without getting a null reference exception.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TransactionHandler</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Transaction</span> <span class="n">transaction</span><span class="o">,</span> <span class="n">AuditLog</span> <span class="n">log</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">log</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
			<span class="n">log</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
		<span class="o">...</span>
	<span class="o">}</span>
	<span class="o">...</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">log</span><span class="o">(</span><span class="n">AuditLog</span> <span class="n">log</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">log</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
			<span class="n">log</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>If you are an Objective-C programmer, then you are lucky, you don’t need to worry about checking if the object is null. But if you are using a mainstream object oriented programming language like me, you need to keep in mind that the objects can be null.</p>

<p>When you need to check null reference multiple times in more than a few methods, then your code is going to start smelling. You should start thinking about something else. Null Object Pattern can be your way out.</p>

<h2 id="null-object-pattern">Null Object Pattern</h2>

<p>Null Object Pattern is actually a special form of <a href="http://martinfowler.com/eaaCatalog/specialCase.html">Special Case</a> pattern. It gives a null meaning to your object and prevents getting null reference error and the best part is: invoking its methods does nothing and there’s no need to check if it is null. It will cost you a method call instead of an if statement, but you will get a cleaner code.</p>

<p>Let’s get back to the design. We can transform the AuditLog class to use the Null Object pattern like below.</p>

<p><img src="/assets/2014/04/nullobjectpattern.png" alt="null object pattern" /></p>

<p>The code will simply be changed to:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AuditLog</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getId</span><span class="o">();</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">);</span>
	<span class="o">...</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AuditLogImpl</span> <span class="kd">implements</span> <span class="n">AuditLog</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">...</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="o">...</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{</span>
		<span class="c1">//Persist to database</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NullAuditLog</span> <span class="kd">implements</span> <span class="n">AuditLog</span> <span class="o">{</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">//Do nothing</span>
	<span class="o">}</span>
	<span class="o">...</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{</span>
		<span class="c1">//Do nothing</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>Invoking the save method with a NullAuditLog instance will do nothing and you don’t need to add a null reference check anymore.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TransactionHandler</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Transaction</span> <span class="n">transaction</span><span class="o">,</span> <span class="n">AuditLog</span> <span class="n">log</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">log</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
		<span class="o">...</span>
	<span class="o">}</span>
	<span class="o">...</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">log</span><span class="o">(</span><span class="n">AuditLog</span> <span class="n">log</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">log</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>Actually using an interface is the optimal usage. But in my design, I simply extended AuditLog class as NullAuditLog and made it a private static class inside of the AuditLog class. With this way null instance may have been retrieved from the NULL constant defined in AuditLog class. You can have a look at it on <a href="https://github.com/tolgaonbay/examples/blob/master/src/com/thingstocode/examples/nullobject/AuditLog.java">github</a>.</p>

<p>There are some downsides of this usage, like when you add new methods to the class, you should remember to add them into your null class. With an interface it is clearer to add method definitions into your interface and implement them in the derived classes.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Even if it came out because of a <a href="http://www.infoq.com/presentations/Null-References-The-Billion-Dollar-Mistake-Tony-Hoare">billion dollar mistake</a>, Null Object Pattern is very handy and makes your code clean. This doesn’t mean that you should apply Null Object Pattern to every single class in your design - it can make things even more complicated and error-prone. It may be used when:</p>

<ul>
  <li>It is possible to have a null reference and assigning null reference has a meaning in the design. For example we used it to not persist a log into the database</li>
  <li>There are many null comparisons for the object across the system
Take a look at the Special Case pattern if you didn’t before. I’m sure you will find it very useful.</li>
</ul>
